---
classes:
  - apt
  - icinga_build

java::package: openjdk-8-jdk

###
# Config from Foreman
###
#jenkins::install_java: true # note: default
#jenkins::repo: false

###
# Config from Hiera
###
#package:
#  ['curl', 'git']:
#    ensure: present
packages:
  - git

#apt::source:
#  jenkins:
#    location: 'http://pkg.jenkins-ci.org/debian'
#    repos: ''
#    key: 'D50582E6'
#    key_source: 'http://pkg.jenkins-ci.org/debian/jenkins-ci.org.key'
#    release: "binary/"
#    include_src: false

jenkins::config_hash:
  #httpListenAddress:
  #  value: '127.0.0.1'

jenkins::executors: 0

# TODO: support adding Jenkins credentials
jenkins::credentials:
  icinga-slaves:
    password: ''
    description: INSECURE Icinga Slave Access key
    private_key_or_path: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEowIBAAKCAQEArRiEYa2EZ7s3xDbwS/+mMMDyL+BVVS2x2O9F6V/JFDCuKMRc
      /URMESuaRETUqhjlAG+urFTi1gsYBALXyrDsSANOzkhhszfXZYDpTcv7nd6sWw6O
      kQIhR5j93hg6QPbhNBYkjDqEal2hBupTxaXyrWvSTzrLIfKxLx0FPBAEG62JDyvE
      b+m2dzGJk3ToptWlfB1UhplzEbWwsf5VRKW365zyafxmxtXsDF6Ts/Za9mFyboUR
      KMXC35YZVQAmu8+AG+UcU11u9aYsilfcdF9bR29ilW3A/28ovkr/PVMEFPmR6tzo
      P+eyDiXKH0k1paWJT9RZ/eaq2z1c3+M1W5UR0QIDAQABAoIBAD/7nQuCGTxCvvVf
      nWlqQWMqHxvFX6WRs3jN0VjXmDtHV0kodHsF4NxD8s0jaDzL4PJNVhLLeeHGzgTF
      jECXL2/bESk9JigaDxutEBA6w3JymeE6u0YstGKD0etjpzzWRR58xNu00beDjn9A
      5OBdXBvwjBfPUsDktcwFfSbbgLk9yxIOMQkMBFtvkrZXMGlqKXZVKj9yWtHcws0H
      T3uVXUhX0VGe0t8Tappg+R3SIojLT21f0tG2lpbKdk5i3CQJvJJzJMu1DIum7aB3
      luUnp37IUpDLSHdbkFI3wVReF8EnaxxFW/tWVWMYTVbg9VBhG5oK4pAVquQBBVSB
      xHOmqbUCgYEA5JJt4ACtxJMNzIRdZSDchmAMihRUHQNuIKtlf0L0vSYRk+imQJQ6
      jrlNUd6fL6D4o5byEqrTNrVnGmm2iXJAneW/wv3z2CoyOED6T7p++gmWqdeOKAVs
      b/LUDQBmPXDufpMtpFPYSBARfP+VDtX1J4kB1T5lmweE1r7ykqo+0psCgYEAwd3l
      wJjm0ZIX8YneAe0w+66MBiLhdYCtng/Pj2UiTtGfQs2Ma0+R002j4JevvjwJytnS
      i6tc2AEgv+f3swwOV/FwOnTqhYfLUEitHrA7p+cJI4E/rOZ7PPSXyNfqVWKgxfhJ
      Nh0MWjMyAI9Ip+7kAT11p5muJ22N4VJKJLuubgMCgYAE8g4ijKE14aCozixfJcjf
      t3BOBIaVYh+d4Vd+22oENbCnrJ78QrjJocTEgrabBzaaA4gVU1DinCYw8hya+Lfh
      MrlldK0z/iW8BdvkobphmpeB8UIIJ6Xi/jQMW/faWHkwj+qq5Y2GcaKPO9Bz07lM
      M7CwdnsoUY9UPiltdvWJBQKBgBX2DRDEQWF8KzoxY/TT6biZDUOkr+Wfrgs5v0l/
      K2PCW0g2ALInUV2ebfIDPOVP58wS4MbxopLVjeAvZt/hfb54mz4EAI0f1OhDU1km
      nZtnkKF1AsGTWmKNUqRt0R3bDltexOxcXgnZwtBNau2bIjkBvVI/Fntg7bGYoM2I
      dToBAoGBAJ3vKVDFt3ccHhPgREzQl05qZPcoJ0P8wMtg3I39Hc5Zy8CJbcQKC+WF
      UuZXJJk1VzqsRvry8keKKhbCUwf0nFcbUM85zL004DS2u3uc9GoULHhmhIG122sJ
      huiZIPGV0AI4JYqchmCtVfbIEw+PAlnK3qUMt6JrvjbiJ5aaBS2s
      -----END RSA PRIVATE KEY-----

jenkins::plugin:
  jenkins-multijob-plugin:
    version: "1.21"
  envinject:
    version: "1.92.1"
  conditional-buildstep:
    version: "1.3.5"
  run-condition:
    version: "1.0"
  categorized-view:
    version: "1.8"
  icon-shim:
    version: "2.0.3"
  docker-commons:
    version: "1.4.0"
  docker-custom-build-environment:
    version: "1.6.5"
  dockerhub-notification:
    version: "2.2.0"
  maven-plugin:
    version: "2.13"
  scoring-load-balancer:
    version: "1.0.1"
  template-project:
    version: "1.5.2"
  copy-to-slave:
    version: "1.4.4"
  git:
    version: "2.5.0"
  multi-branch-project-plugin:
    version: "0.4.2"
  xunit:
    version: "1.102"
  ansicolor:
    version: "0.4.2"
  matrix-reloaded:
    version: "1.1.3"
  versionnumber:
    version: "1.6"
  promoted-builds:
    version: "2.27"
  # already defined internally
  #credentials:
  #  version: "2.1.10"
  git-client:
    version: "1.19.6"
  scm-api:
    version: "1.2"
  mailer:
    version: "1.17"
  token-macro:
    version: "1.12.1"
  matrix-project:
    version: "1.7.1"
  ssh-credentials:
    version: "1.12"
  parameterized-trigger:
    version: "2.31"
  authentication-tokens:
    version: "1.3"
  async-http-client:
    version: "1.7.24.1"
  matrix-auth:
    version: "1.4"
  ldap:
    version: "1.12"
  junit:
    version: "1.13"
  script-security:
    version: "1.20"
  ssh-slaves:
    version: "1.11"
  copyartifact:
    version: "1.38"
  structs:
    version: "1.2"
  workflow-step-api:
    version: "2.1"
  workflow-scm-step:
    version: "2.1"
  javadoc:
    version: "1.4"
  embeddable-build-status:
    version: "1.9"
  github-api:
    version: "1.84"
  plain-credentials:
    version: "1.3"
  github:
    version: "1.25.0"
  # added for testing
  cloudbees-folder:
    version: '5.16'

jenkins::job:
  docker-debian-images:
    template: "jenkins/icinga/docker_template.erb"
    params:
      os: "debian"
      arch:
        - "i386"
        - "amd64"
#        - "armhf"
      release:
        - "wheezy"
        - "jessie"
      parent: "debian"
      combination_filter: |
        <combinationFilter>!(release=="squeeze" &amp;&amp; arch=='armhf')</combinationFilter>
      description: "debian docker images"

  docker-centos-images:
    template: "jenkins/icinga/docker_template.erb"
    params:
      os: "centos"
      arch:
        - "i386"
        - "amd64"
      release:
        - "5"
        - "6"
        - "7"
      parent: "centos"
      combination_filter: |
        <combinationFilter>!(release=="7" &amp;&amp; arch=="i386")</combinationFilter>
      description: "centos docker images"

  docker-fedora-images:
    template: "jenkins/icinga/docker_template.erb"
    params:
      os: "fedora"
      arch:
        - "i386"
        - "amd64"
      release:
        - "24"
        - "25"
      parent: "centos"
      description: "fedora docker images"

  docker-ubuntu-images:
    template: "jenkins/icinga/docker_template.erb"
    params:
      os: "ubuntu"
      arch:
        - "i386"
        - "amd64"
      release:
        - "precise"
        - "trusty"
        - "xenial"
      parent: "debian"
      description: "ubuntu docker images"

#  docker-raspbian-images:
#    template: "jenkins/icinga/docker_template.erb"
#    params:
#      os: "raspbian"
#      arch:
#        - "armhf"
#      release:
#        - "wheezy"
#        - "jessie"
#      parent: "debian"
#      description: "raspbian docker images"

  docker-sles-images:
    template: "jenkins/icinga/docker_template.erb"
    params:
      os: "sles"
      arch:
        - "i386"
        - "amd64"
      release:
        - "11-sp4"
        - "12-sp1"
        - "12-sp2"
      combination_filter: |
          <combinationFilter>!(release=="12-sp1" &amp;&amp; arch=="i386") &amp;&amp; !(release=="12-sp2" &amp;&amp; arch=="i386")</combinationFilter>
      parent: "suse"
      description: "sles docker images"

  docker-opensuse-images:
    template: "jenkins/icinga/docker_template.erb"
    params:
      os: "opensuse"
      arch:
        - "i386"
        - "amd64"
      release:
        - "13.2"
        - "42.1"
      parent: "suse"
      description: "open suse docker images"
      combination_filter: |
        <combinationFilter>!(release=="42.1" &amp;&amp; arch=="i386")</combinationFilter>

  docker-bootstrap-image:
    template: "jenkins/icinga/standalone_single.erb"
    params:
      scm:
        url: "git@git.netways.org:jenkins/docker-images.git"
        branch: "*/master"
        user: "3d6b7794-be0d-424a-99bd-b8bb3e9004c2"
      build_script: "
        cd docker-images-bootstrap ;
        docker build --tag net-docker-registry.adm.netways.de:5000/netways/docker-images-bootstrap-vivid . ;
        export image_name=netways/docker-images-bootstrap-vivid ;
        ./../jenkins-scripts/modules/push_docker_image ;"


  boost-rpm-package:
    template: "jenkins/icinga/rpm_boost.erb"
    params:
      description: "rpm boost packages"
      distro:
        - "centos-5"
        - "centos-6"
        - "sles-11-sp4"
      arch:
        - "x86"
        - "x86_64"
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/boost-rpm-template

  icinga2-debian-package-test:
    template: "jenkins/icinga/package_test.erb"
    params:
      description: "Icinga 2 Debian package tests"
      distro:
        - "debian-wheezy"
        - "debian-jessie"
      repository:
        - "snapshot"
        - "release"
      arch:
        - "x86"
        - "x86_64"
#        - "armhf"
      combination_filter: |
        <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga2-deb-test-template

#  icinga2-raspbian-package-test:
#    template: "jenkins/icinga/package_test.erb"
#    params:
#      description: "Icinga 2 Raspbian package tests"
#      distro:
#        - "raspbian-wheezy"
#      repository:
#        - "snapshot"
#        - "release"
#      arch:
#        - "armhf"
#      build_command: |
#        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icinga2-deb-test-template

  icinga2-ubuntu-package-test:
    template: "jenkins/icinga/package_test.erb"
    params:
      description: "Icinga 2 Ubuntu package tests"
      distro:
        - "ubuntu-precise"
        - "ubuntu-trusty"
        - "ubuntu-xenial"
      repository:
        - "snapshot"
        - "release"
      arch:
        - "x86"
        - "x86_64"
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga2-deb-test-template

  icinga2-centos-package-test:
    template: "jenkins/icinga/package_test.erb"
    params:
      description: "Icinga 2 centos package tests"
      distro:
        - "centos-5"
        - "centos-6"
        - "centos-7"
      repository:
        - "snapshot"
        - "release"
      arch:
        - "x86"
        - "x86_64"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-test-template
      combination_filter: |
        <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>

  icinga2-sles-package-test:
    template: "jenkins/icinga/package_test.erb"
    params:
      description: "Icinga 2 sles package tests"
      distro:
        - "sles-11-sp4"
        - "sles-12-sp2"
      repository:
        - "snapshot"
        - "release"
      arch:
        - "x86"
        - "x86_64"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-test-template
      combination_filter: |
        <combinationFilter>!(distro=="sles-12-sp1" &amp;&amp; arch=="x86") &amp;&amp; !(distro=="sles-12-sp2" &amp;&amp; arch=="x86")</combinationFilter>

  icinga2-opensuse-package-test:
    template: "jenkins/icinga/package_test.erb"
    params:
      description: "Icinga 2 opensuse package tests"
      distro:
        - "opensuse-13.2"
        - "opensuse-42.1"
      repository:
        - "snapshot"
        - "release"
      arch:
        - "x86"
        - "x86_64"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-test-template
      combination_filter: |
        <combinationFilter>!(distro=="opensuse-42.1" &amp;&amp; arch=="x86")</combinationFilter>

  icinga2-fedora-package-test:
    template: "jenkins/icinga/package_test.erb"
    params:
      description: "Icinga 2 fedora package tests"
      distro:
        - "fedora-24"
        - "fedora-25"
      repository:
        - "snapshot"
        - "release"
      arch:
        - "x86"
        - "x86_64"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-test-template

  icingarepository-centos-rpm-package:
    template: "jenkins/icinga/icingarepository.erb"
    params:
      description: "Icinga centos repositories"
      distro:
        - "centos-5"
        - "centos-6"
        - "centos-7"
      arch:
        - "x86"
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>

  icingarepository-fedora-rpm-package:
    template: "jenkins/icinga/icingarepository.erb"
    params:
      description: "Icinga fedora repositories"
      distro:
        - "fedora-24"
        - "fedora-25"
      arch:
        - "x86"
        - "x86_64"

  icinga2-hook:
    template: "jenkins/icinga/package_multi.erb"
    params:
      auth_token: "RoeCjeZmqc8a4muWpDIgy6A6X"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Hook"
          jobs:
            - "icinga2-hook-ubuntu"
            - "icinga2-hook-debian"
            - "icinga2-hook-centos"
          abort_all_job: "false"

  icinga2-hook-ubuntu:
    template: "jenkins/icinga/standalone_single.erb"
    params:
      parameter:
        - name: "branch"
          default: "origin/master"
      scm:
        url: "https://github.com/Icinga/icinga2.git"
        branch: "$branch"
      docker: "net-docker-registry.adm.netways.de:5000/netways/ubuntu-trusty-x86_64"
      build_script: "export dist=ubuntu;
sudo -E setarch x86_64 jenkins-scripts/jobs/icinga2-hook"

  icinga2-hook-debian:
    template: "jenkins/icinga/standalone_single.erb"
    params:
      parameter:
        - name: "branch"
          default: "origin/master"
      scm:
        url: "https://github.com/Icinga/icinga2.git"
        branch: "$branch"
      docker: "net-docker-registry.adm.netways.de:5000/netways/debian-jessie-x86_64"
      build_script: "export dist=debian;
sudo -E setarch x86_64 jenkins-scripts/jobs/icinga2-hook"

  icinga2-hook-centos:
    template: "jenkins/icinga/standalone_single.erb"
    params:
      parameter:
        - name: "branch"
          default: "origin/master"
      scm:
        url: "https://github.com/Icinga/icinga2.git"
        branch: "$branch"
      docker: "net-docker-registry.adm.netways.de:5000/netways/centos-7-x86_64"
      build_script: "export dist=centos;
sudo -E setarch x86_64 jenkins-scripts/jobs/icinga2-hook"

  icinga2:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Mega meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "all"
          jobs:
            - "icinga2-deb"
            - "icinga2-rpm"
            - "icinga2-windows-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
          killCond: 'NEVER'

  icinga2-deb:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Deb meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icinga2-debian-package"
#               - "icinga2-raspbian-package"
            - "icinga2-ubuntu-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
        - name: "Test"
          jobs:
            - "icinga2-debian-package-test"
#           - "icinga2-raspbian-package-test"
            - "icinga2-ubuntu-package-test"
          killCond: 'NEVER'

  icinga2-debian-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Debian icinga2 packages"
      distro:
        - "debian-wheezy"
        - "debian-jessie"
      arch:
        - "x86"
        - "x86_64"
#        - "armhf"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga2.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga2-deb-template
      combination_filter: |
        <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>

#  icinga2-raspbian-package:
#    template: "jenkins/icinga/package_template.erb"
#    params:
#      description: "icinga2 raspbian package"
#      distro:
#        - "raspbian-wheezy"
#      arch:
#        - "armhf"
#      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
#      repository_url: "https://github.com/Icinga/icinga2.git"
#      branch: "origin/master"
#      build_command: |
#        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga2-deb-template
#      combination_filter: |
#        <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>

  icinga2-ubuntu-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga2 ubuntu package"
      distro:
        - "ubuntu-precise"
        - "ubuntu-trusty"
        - "ubuntu-xenial"
      arch:
        - "x86"
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga2.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga2-deb-template

  icinga2-rpm:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "RPM meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icinga2-centos-package"
            - "icinga2-fedora-package"
            - "icinga2-opensuse-package"
            - "icinga2-sles-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
        - name: "Test"
          jobs:
            - "icinga2-centos-package-test"
            - "icinga2-fedora-package-test"
            - "icinga2-opensuse-package-test"
            - "icinga2-sles-package-test"
          killCond: 'NEVER'

  icinga2-centos-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga2 centos packages"
      distro:
        - "centos-5"
        - "centos-6"
        - "centos-7"
      arch:
        - "x86"
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga2.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-template

  icinga2-fedora-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icinga 2 packages for fedora"
      distro:
        - "fedora-24"
        - "fedora-25"
      arch:
        - "x86"
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga2.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-template

  icinga2-sles-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icinga 2 packages for sles"
      distro:
        - "sles-11-sp4"
        - "sles-12-sp2"
      arch:
        - "x86"
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="sles-12-sp1" &amp;&amp; arch=="x86") &amp;&amp; !(distro=="sles-12-sp2" &amp;&amp; arch=="x86")</combinationFilter>
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga2.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-template

  icinga2-opensuse-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icinga 2 packages for OpenSuse"
      distro:
        - "opensuse-13.2"
        - "opensuse-42.1"
      arch:
        - "x86"
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="opensuse-42.1" &amp;&amp; arch=="x86")</combinationFilter>
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga2.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga2-rpm-template

  icinga2-windows-package:
    template: "jenkins/icinga/package_windows_icinga2.erb"


  icinga:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Mega meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "all"
          jobs:
            - "icinga-deb"
            - "icinga-rpm"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
          killCond: 'NEVER'

  icinga-deb:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Deb meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icinga-debian-package"
#               - "icinga-raspbian-package"
            - "icinga-ubuntu-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
          killCond: 'NEVER'

  icinga-debian-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga debian packages"
      distro:
        - "debian-wheezy"
        - "debian-jessie"
      arch:
        - "x86"
        - "x86_64"
#        - "armhf"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      combination_filter: |
        <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>
      repository_url: "https://github.com/Icinga/icinga-core.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga-deb-template

#  icinga-raspbian-package:
#    template: "jenkins/icinga/package_template.erb"
#    params:
#      description: "icinga raspbian package"
#      distro:
#        - "raspbian-wheezy"
#      arch:
#        - "armhf"
#      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
#      repository_url: "https://github.com/Icinga/icinga-core.git"
#      branch: "origin/master"
#      build_command: |
#        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga-deb-template

  icinga-ubuntu-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga ubuntu package"
      distro:
        - "ubuntu-precise"
        - "ubuntu-trusty"
        - "ubuntu-xenial"
      arch:
        - "x86"
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga-core.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icinga-deb-template

  icinga-rpm:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "RPM meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icinga-centos-package"
            - "icinga-fedora-package"
            - "icinga-opensuse-package"
            - "icinga-sles-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
        - name: "Test"
          jobs:
            - "icinga-centos-package-test"
            - "icinga-fedora-package-test"
            - "icinga-opensuse-package-test"
            - "icinga-sles-package-test"
          killCond: 'NEVER'

  icinga-centos-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga centos packages"
      distro:
        - "centos-5"
        - "centos-6"
        - "centos-7"
      arch:
        - "x86"
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      combination_filter: |
        <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>
      repository_url: "https://github.com/Icinga/icinga-core.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga-rpm-template

  icinga-fedora-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga fedora packages"
      distro:
        - "fedora-24"
        - "fedora-25"
      arch:
        - "x86"
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga-core.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga-rpm-template

  icinga-sles-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga sles packages"
      distro:
        - "sles-11-sp4"
        - "sles-12-sp2"
      arch:
        - "x86"
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      combination_filter: |
        <combinationFilter>!(distro=="sles-12-sp1" &amp;&amp; arch=="x86") &amp;&amp; !(distro=="sles-12-sp2" &amp;&amp; arch=="x86")</combinationFilter>
      repository_url: "https://github.com/Icinga/icinga-core.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga-rpm-template

  icinga-opensuse-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icinga opensuse packages"
      distro:
        - "opensuse-13.2"
        - "opensuse-42.1"
      arch:
        - "x86"
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="opensuse-42.1" &amp;&amp; arch=="x86")</combinationFilter>
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      docker_volumes:
        - host_path: "/home/jenkins/.ccache"
        - client_path: "/home/jenkins/.ccache"
      repository_url: "https://github.com/Icinga/icinga-core.git"
      branch: "origin/master"
      build_command: |
        case $arch in x86) arch_name=i386 ;; x86_64) arch_name=x86_64 ;; esac; root_exec setarch $arch_name jenkins-scripts/jobs/icinga-rpm-template

  icingaweb:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Mega meta job"
      timer_trigger: "H 3 * * *"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "all"
          jobs:
            - "icingaweb-deb"
            - "icingaweb-rpm"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
          killCond: 'NEVER'

  icingaweb-rpm:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "RPM meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icingaweb-centos-package"
            - "icingaweb-fedora-package"
            - "icingaweb-opensuse-package"
            - "icingaweb-sles-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
          killCond: 'NEVER'

  icingaweb-centos-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icingaweb centos packages"
      distro:
        - "centos-5"
        - "centos-6"
        - "centos-7"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      combination_filter: |
        <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>
      repository_url: "https://github.com/Icinga/icinga-web.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb-rpm-template

  icingaweb-fedora-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icingaweb fedora packages"
      distro:
        - "fedora-24"
        - "fedora-25"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      repository_url: "https://github.com/Icinga/icinga-web.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb-rpm-template

  icingaweb-opensuse-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icingaweb opensuse packages"
      distro:
        - "opensuse-13.2"
        - "opensuse-42.1"
      arch:
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="opensuse-42.1" &amp;&amp; arch=="x86")</combinationFilter>
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      repository_url: "https://github.com/Icinga/icinga-web.git"
      branch: "origin/master"
      build_command: |
        arch_name=x86_64 ; root_exec setarch $arch_name jenkins-scripts/jobs/icingaweb-rpm-template

  icingaweb-sles-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb sles packages"
      distro:
        - "sles-11-sp4"
        - "sles-12-sp2"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      combination_filter: |
        <combinationFilter>!(distro=="sles-12-sp1" &amp;&amp; arch=="x86") &amp;&amp; !(distro=="sles-12-sp2" &amp;&amp; arch=="x86")</combinationFilter>
      repository_url: "https://github.com/Icinga/icinga-web.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb-rpm-template

  icingaweb-deb:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Deb meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icingaweb-debian-package"
#               - "icingaweb-raspbian-package"
            - "icingaweb-ubuntu-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
          killCond: 'NEVER'

  icingaweb-debian-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb debian packages"
      distro:
        - "debian-wheezy"
        - "debian-jessie"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      combination_filter: |
        <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>
      repository_url: "https://github.com/Icinga/icinga-web.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb-deb-template

#  icingaweb-raspbian-package:
#    template: "jenkins/icinga/package_template.erb"
#    params:
#      description: "Icingaweb Raspbian packages"
#      distro:
#        - "raspbian-wheezy"
#      arch:
#        - "armhf"
#      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
#      repository_url: "https://github.com/Icinga/icinga-web.git"
#      branch: "origin/master"
#      build_command: |
#        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb-deb-template

  icingaweb-ubuntu-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icingaweb Ubuntu packages"
      distro:
        - "ubuntu-precise"
        - "ubuntu-trusty"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      repository_url: "https://github.com/Icinga/icinga-web.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb-deb-template

  icingaweb2:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Mega meta job"
      timer_trigger: "H 4 * * *"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "All"
          jobs:
            - "icingaweb2-deb"
            - "icingaweb2-rpm"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'

  icingaweb2-rpm:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "RPM meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icingaweb2-centos-package"
            - "icingaweb2-fedora-package"
            - "icingaweb2-opensuse-package"
            - "icingaweb2-sles-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
        - name: "Test"
          jobs:
            - "icingaweb2-centos-test"
            - "icingaweb2-fedora-test"
          killCond: 'NEVER'

  icingaweb2-centos-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb2 centos packages"
      distro:
        - "centos-6"
        - "centos-7"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      combination_filter: |
        <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>
      repository_url: "https://github.com/Icinga/icingaweb2.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-rpm-template

  icingaweb2-fedora-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb2 fedora packages"
      distro:
        - "fedora-24"
        - "fedora-25"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      repository_url: "https://github.com/Icinga/icingaweb2.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-rpm-template

  icingaweb2-opensuse-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb2 opensuse packages"
      distro:
        - "opensuse-13.2"
        - "opensuse-42.1"
      arch:
        - "x86_64"
      combination_filter: |
        <combinationFilter>!(distro=="opensuse-42.1" &amp;&amp; arch=="x86")</combinationFilter>
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      repository_url: "https://github.com/Icinga/icingaweb2.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-rpm-template

  icingaweb2-sles-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "Icinga 2 sles package tests"
      distro:
        - "sles-11-sp4"
        - "sles-12-sp2"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      combination_filter: |
        <combinationFilter>!(distro=="sles-12-sp1" &amp;&amp; arch=="x86") &amp;&amp; !(distro=="sles-12-sp2" &amp;&amp; arch=="x86")</combinationFilter>
      repository_url: "https://github.com/Icinga/icingaweb2.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-rpm-template

  icingaweb2-deb:
    template: "jenkins/icinga/package_multi.erb"
    params:
      description: "Deb meta job"
      parameter:
        - name: "branch"
          default: "origin/master"
      phase:
        - name: "Build"
          jobs:
            - "icingaweb2-debian-package"
#           - "icingaweb2-raspbian-package"
            - "icingaweb2-ubuntu-package"
          config: '<hudson.plugins.parameterizedtrigger.CurrentBuildParameters plugin="parameterized-trigger@2.30"/>'
        - name: "Test"
          jobs:
            - "icingaweb2-debian-test"
            - "icingaweb2-ubuntu-test"
          killCond: 'NEVER'

  icingaweb2-debian-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb2 debian packages"
      distro:
        - "debian-wheezy"
        - "debian-jessie"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      combination_filter: |
        <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>
      repository_url: "https://github.com/Icinga/icingaweb2.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-deb-template

#  icingaweb2-raspbian-package:
#    template: "jenkins/icinga/package_template.erb"
#    params:
#      description: "icingaweb2 Raspbian packages"
#      distro:
#        - "raspbian-wheezy"
#      arch:
#        - "armhf"
#      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
#      repository_url: "https://github.com/Icinga/icingaweb2.git"
#      branch: "origin/master"
#      build_command: |
#        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-deb-template

  icingaweb2-ubuntu-package:
    template: "jenkins/icinga/package_template.erb"
    params:
      description: "icingaweb2 Ubuntu packages"
      distro:
        - "ubuntu-trusty"
        - "ubuntu-xenial"
      arch:
        - "x86_64"
      docker_image: "net-docker-registry.adm.netways.de:5000/netways/$distro-$arch"
      repository_url: "https://github.com/Icinga/icingaweb2.git"
      branch: "origin/master"
      build_command: |
        arch_cmd="setarch x86_64" ; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-deb-template

  icingaweb2-debian-test:
    template: "jenkins/icinga/package_test.erb"
    params:
       distro:
         - "debian-wheezy"
         - "debian-jessie"
       repository:
         - "snapshot"
         - "release"
       arch:
         - "x86"
         - "x86_64"
 #        - "armhf"
       combination_filter: |
         <combinationFilter>!(distro=="debian-squeeze" &amp;&amp; arch=="armhf")</combinationFilter>
       build_command: |
         case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-test

  icingaweb2-ubuntu-test:
    template: "jenkins/icinga/package_test.erb"
    params:
       distro:
        - "ubuntu-trusty"
        - "ubuntu-xenial"
       repository:
         - "snapshot"
         - "release"
       arch:
         - "x86"
         - "x86_64"
       build_command: |
         case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-test

  icingaweb2-centos-test:
    template: "jenkins/icinga/package_test.erb"
    params:
       distro:
        - "centos-6"
        - "centos-7"
       repository:
         - "snapshot"
         - "release"
       arch:
         - "x86"
         - "x86_64"
       combination_filter: |
         <combinationFilter>!(distro=="centos-7" &amp;&amp; arch=="x86")</combinationFilter>
       build_command: |
         case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-test

  icingaweb2-fedora-test:
    template: "jenkins/icinga/package_test.erb"
    params:
       distro:
         - "fedora-24"
         - "fedora-25"
       repository:
         - "snapshot"
         - "release"
       arch:
         - "x86"
         - "x86_64"
       build_command: |
         case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-test

  icingaweb2-opensuse-test:
    template: "jenkins/icinga/package_test.erb"
    params:
       distro:
         - "opensuse-13.2"
         - "opensuse-42.1"
       repository:
         - "snapshot"
         - "release"
       arch:
         - "x86"
         - "x86_64"
       combination_filter: |
           <combinationFilter>!(distro=="opensuse-42.1" &amp;&amp; arch=="x86")</combinationFilter>
       build_command: |
         case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-test

  icingaweb2-sles-test:
    template: "jenkins/icinga/package_test.erb"
    params:
       distro:
         - "sles-11-sp4"
         - "sles-12-sp2"
       repository:
         - "snapshot"
         - "release"
       arch:
         - "x86"
         - "x86_64"
       combination_filter: |
         <combinationFilter>!(distro=="sles-12-sp1" &amp;&amp; arch=="x86") &amp;&amp; !(distro=="sles-12-sp2" &amp;&amp; arch=="x86")</combinationFilter>
       build_command: |
         case $arch in x86) arch_cmd="setarch i386" ;; x86_64) arch_cmd="setarch x86_64" ;; esac; root_exec $arch_cmd jenkins-scripts/jobs/icingaweb2-test

  # end jenkins::job
